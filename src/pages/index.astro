---
import type { SanityDocument } from "@sanity/client";
import { loadQuery } from "../sanity/lib/load-query";
import { urlForImage } from "../sanity/lib/url-for-image";
import { postsQuery } from "../sanity/lib/queries";
import Layout from "../layouts/Layout.astro";

const { data: posts } = await loadQuery<SanityDocument[]>({
  query: postsQuery,
});
---

<Layout>
  <main>
    <h1>Alle Posts</h1>
    <div class="u-grid posts-grid">
      {
        posts.map((post) => (
          <article class="post-card">
            {post.mainImage && (
              <a
                href={`/post/${post.slug.current}`}
                class="post-card__image-link"
              >
                <img
                  src={urlForImage(post.mainImage).width(600).height(400).url()}
                  alt={post.mainImage.alt || post.title}
                  class="post-card__image"
                />
              </a>
            )}
            <div class="post-card__content">
              <h2 class="post-card__title">
                <a href={`/post/${post.slug.current}`}>{post.title}</a>
              </h2>
              {post.author && (
                <p class="post-card__author">Door {post.author.name}</p>
              )}
              {post.categories && post.categories.length > 0 && (
                <div class="post-card__categories">
                  {post.categories.map((category: any) => (
                    <span class="post-card__category">{category.title}</span>
                  ))}
                </div>
              )}
            </div>
          </article>
        ))
      }
    </div>
  </main>
</Layout>

<style>
  main {
    padding-block: var(--space-xl);
  }

  h1 {
    margin-block-end: var(--space-xl);
  }

  .posts-grid {
    grid-template-columns: repeat(auto-fill, minmax(min(100%, 20rem), 1fr));
  }

  .post-card {
    display: flex;
    flex-direction: column;
    background: var(--color-surface);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-large);
    overflow: hidden;
    transition:
      transform 0.2s ease,
      box-shadow 0.2s ease;
  }

  .post-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  }

  .post-card__image-link {
    display: block;
    overflow: hidden;
    aspect-ratio: 16 / 9;
  }

  .post-card__image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s ease;
  }

  .post-card:hover .post-card__image {
    transform: scale(1.05);
  }

  .post-card__content {
    padding: var(--space-m);
    display: flex;
    flex-direction: column;
    gap: var(--space-s);
    flex: 1;
  }

  .post-card__title {
    margin: 0;
    font-size: var(--step-1);
  }

  .post-card__title a {
    color: var(--color-text);
    text-decoration: none;
  }

  .post-card__title a:hover {
    color: var(--primary);
  }

  .post-card__author {
    margin: 0;
    color: var(--color-muted);
    font-size: var(--step--1);
  }

  .post-card__categories {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-xs);
    margin-top: auto;
  }

  .post-card__category {
    display: inline-block;
    padding: var(--space-2xs) var(--space-xs);
    background: var(--primary-20);
    color: var(--primary);
    border-radius: var(--radius-small);
    font-size: var(--step--2);
    font-weight: 500;
  }
</style>
